var syrup=function(t,u,i,c,o){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u,i=i&&i.hasOwnProperty("default")?i.default:i,o=o&&o.hasOwnProperty("default")?o.default:o;function h(t,e,n,s,r,i,a){try{var o=t[i](a),u=o.value}catch(t){return void n(t)}o.done?e(u):Promise.resolve(u).then(s,r)}function s(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var e=function(){var o,e=(o=regeneratorRuntime.mark(function t(e){var n,s,r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.projectID,s=e.pageID,r=e.respondentID,n){t.next=3;break}throw new Error("Missing projectID argument!");case 3:if(s){t.next=5;break}throw new Error("Missing pageID argument!");case 5:if(r){t.next=7;break}throw new Error("Missing respondentID argument!");case 7:return i=p.BASE_URL+"?projectid=".concat(n,"&pageid=").concat(s,"&respondentid=").concat(r),t.prev=8,t.next=11,u.get(i);case 11:return a=t.sent,t.abrupt("return",new p(a.data));case 15:throw t.prev=15,t.t0=t.catch(8),console.error(t.t0),new Error("Unable to load / process respondent data from ".concat(i));case 19:case"end":return t.stop()}},t,this,[[8,15]])}),function(){var t=this,a=arguments;return new Promise(function(e,n){var s=o.apply(t,a);function r(t){h(s,e,n,r,i,"next",t)}function i(t){h(s,e,n,r,i,"throw",t)}r(void 0)})});return function(t){return e.apply(this,arguments)}}(),p=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_rawData",{}),r(this,"_survey",i()),r(this,"_questions",i()),this._rawData=t,this._questions=i(this._rawData.questions),this._survey=i(this._rawData)}return n(e,null,[{key:"setBaseURL",value:function(t){e.BASE_URL=t}}]),n(e,[{key:"survey",value:function(){return this._survey()}},{key:"questions",value:function(){return this._questions()}},{key:"rawData",get:function(){return this._rawData}},{key:"isComplete",get:function(){return this._rawData.hasOwnProperty("duration")}},{key:"projectID",get:function(){return this._rawData.projectID?this._rawData.projectID:void 0}},{key:"pageID",get:function(){return this._rawData.pageID?this._rawData.pageID:void 0}},{key:"respondentID",get:function(){return this._rawData.respondentID?this._rawData.respondentID:void 0}}]),e}();function a(t){return o(t).utc().format("HH:mm:ss.SSS")}function l(t,e){if(c.has(t,"questionTitle")){var n="started ".concat(t.questionTitle," at ").concat(t.startTime),s="finished ".concat(t.questionTitle," in ").concat(a(t.duration));if(e.push({text:n}),c.has(t,"qResponseData.basketContent")){var r=[];f(t.qResponseData,r),e.push(r)}e.push({text:s})}}function f(t,e){c.has(t,"basketContent")&&t.basketContent.forEach(function(t){e.push({text:"purchase ".concat(t.quantity," x ").concat(t.title)})})}return r(p,"BASE_URL","https://survey-api.conceptsauce.io"),i.extend("timings",function(){this.context({results:this.getDBI().query(this.context())});var n=[],t=this.context().results;return 0<t.length&&t.forEach(function(t){var e={};e.startTime=c.get(t,"startTime",""),e.endTime=c.get(t,"endTime",""),e.duration=c.get(t,"duration",""),e.questionID=c.get(t,"questionID",""),e.questionTitle=c.get(t,"questionTitle",""),e.type=c.get(t,"type",""),n.push(e)}),n}),i.extend("cs_targetQuestions",function(t){return 0===t.length?[]:c.has(t[0],"questions")?t[0].questions:c.has(t[0],"questionID")?t:[]}),i.extend("qTitle",function(t){var e=i();this.context({results:this.getDBI().query(this.context())});var n=this.cs_targetQuestions(this.context().results),s={questionTitle:t},r=(e=i(n))().filter(s);return this.context({results:e().getDBI().query(r.context())}),this}),i.extend("LV2D",function(){var t=i();this.context({results:this.getDBI().query(this.context())});var e=this.cs_targetQuestions(this.context().results),n=(t=i(e))().filter({type:"LV2D"});return this.context({results:t().getDBI().query(n.context())}),this}),i.extend("productViews",function(){this.context({results:this.getDBI().query(this.context())});var t=this.context().results.map(function(t,e){var n={};if(c.has(t,"qResponseData.basketContent"))return n.questionID=t.questionID,n.type=t.type,n.questionTitle=t.questionTitle,n.startTime=t.startTime,n.endTime=t.endTime,n.duration=t.duration,n.productViewEvents=t.qResponseData.productViewEvents,n.productViewEvents.forEach(function(t){t.UPC=t.userMeta.UPC}),n});return i(c.remove(t,function(t){return null!==t}))()}),i.extend("baskets",function(){this.context({results:this.getDBI().query(this.context())});var t=this.context().results.map(function(t,e){var r={};if(c.has(t,"qResponseData.basketContent")){r.questionID=t.questionID,r.type=t.type,r.questionTitle=t.questionTitle,r.startTime=t.startTime,r.endTime=t.endTime,r.duration=t.duration,r.basketContent=t.qResponseData.basketContent,r.basketEvents=t.qResponseData.basketEvents,r.basketEvents.forEach(function(t){t.UPC=t.userMeta.UPC});var i,a=!0;return r.basketContent.forEach(function(t){var e=t.userMeta.UPC,n=c.find(r.basketEvents,function(t){return t.UPC===e&&"ProductAddedToCart"===t.eventName}).startTime;if(t.startTime=n,a)t.timeFromLastPurchase=0,a=!1;else{var s=o(n).utc().diff(i);t.timeFromLastPurchase=o.utc(s).format("HH:mm:ss.sss")}i=o(n).utc()}),r}return null});return i(c.remove(t,function(t){return null!==t}))()}),i.extend("simpleProductViewsObj",function(){this.context({results:this.getDBI().query(this.context())});var t;return t=this.context().results.map(function(t,e){var n,s=[],r=[];return c.has(t,"productViewEvents")||c.has(t,"qResponseData.productViewEvents")?(n={questionID:t.questionID,questionTitle:t.questionTitle,views:[],skus:[]},c.has(t,"qResponseData")&&(t=t.qResponseData),t.productViewEvents.forEach(function(t){s.push({startTime:t.startTime,endTime:t.endTime,duration:t.duration,description:t.description,title:t.title,UPC:t.userMeta.UPC}),r.push(t.userMeta.UPC)}),n.views=s,n.skus=r,n):null}),c.remove(t,function(t){return null!==t})}),i.extend("simpleBasketObj",function(){this.context({results:this.getDBI().query(this.context())});var t;return t=this.context().results.map(function(t,e){var n,r=[],i=[],a=0,o=0;return"none"===c.get(t,"basketContent","none")&&"none"===c.get(t,"qResponseData.basketContent","none")?null:(n={questionID:t.questionID,questionTitle:t.questionTitle,basket:[],skus:[],totalBasketPrice:0,totalBasketUniqueItems:0},"none"!==c.get(t,"qResponseData","none")&&(t=t.qResponseData),t.basketContent.forEach(function(t){var e=parseFloat(t.priceParams.basePrice),n=parseInt(t.quantity),s=e*n;a+=s,o++,r.push({qty:c.ceil(n,2),description:t.description,title:t.title,UPC:t.userMeta.UPC,unitPrice:c.ceil(e,2),totalPrice:c.ceil(s,2)}),i.push(t.userMeta.UPC)}),n.basket=r,n.skus=i,n.totalBasketPrice=c.ceil(a,2),n.totalBasketUniqueItems=c.ceil(o,0),n)}),c.remove(t,function(t){return null!==t})}),i.extend("story",function(){this.context({results:this.getDBI().query(this.context())});var n=[];return this.context().results.map(function(t,e){console.dir(t),c.has(t,"questions")?function(t,n){n.push({text:"".concat(t.respondentID,": started survey at ").concat(t.startTime)}),o().utc();var e={text:"".concat(t.respondentID,": finished survey in ").concat(a(t.duration))};t.questions.forEach(function(t){var e=[];l(t,e),n.push(e)}),n.push(e)}(t,n):c.has(t,"qResponseData")||c.has(t,"type")?l(t,n):f(t,n)}),c.flattenDeep(n)}),t.fetchRespondentData=e,t.RespondentData=p,t.version="0.1.0",t}({},axios,TAFFY,_,moment);
